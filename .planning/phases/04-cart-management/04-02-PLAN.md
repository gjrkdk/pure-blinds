---
phase: 04-cart-management
plan: 02
type: execute
wave: 2
depends_on: ["04-01"]
files_modified:
  - src/app/cart/page.tsx
  - src/components/cart/cart-item.tsx
  - src/components/cart/cart-summary.tsx
  - src/components/cart/remove-dialog.tsx
  - src/components/cart/quantity-input.tsx
autonomous: true

must_haves:
  truths:
    - "Cart page displays all added items with product name, dimensions, and price"
    - "Customer can change quantity of each cart item"
    - "Customer can remove an item after confirming in a dialog"
    - "Cart shows per-item subtotals and a running total"
    - "Empty cart shows message with back navigation"
    - "Cart page is mobile-responsive with sticky checkout footer"
  artifacts:
    - path: "src/app/cart/page.tsx"
      provides: "Cart page route at /cart"
      min_lines: 30
    - path: "src/components/cart/cart-item.tsx"
      provides: "Individual cart item display with dimensions and price"
      contains: "CartItem"
    - path: "src/components/cart/cart-summary.tsx"
      provides: "Sticky footer with subtotal and checkout button"
      contains: "Proceed to Checkout"
    - path: "src/components/cart/remove-dialog.tsx"
      provides: "Accessible confirmation dialog for item removal"
      contains: "alertdialog"
    - path: "src/components/cart/quantity-input.tsx"
      provides: "Quantity input with validation (min 1, max 999)"
      contains: "quantity"
  key_links:
    - from: "src/app/cart/page.tsx"
      to: "src/lib/cart/store.ts"
      via: "useCartStore for reading cart items"
      pattern: "useCartStore"
    - from: "src/components/cart/cart-item.tsx"
      to: "src/components/cart/quantity-input.tsx"
      via: "QuantityInput rendered per item"
      pattern: "QuantityInput"
    - from: "src/components/cart/cart-item.tsx"
      to: "src/components/cart/remove-dialog.tsx"
      via: "RemoveDialog triggered by remove button"
      pattern: "RemoveDialog|RemoveCartItemDialog"
    - from: "src/components/cart/quantity-input.tsx"
      to: "src/lib/cart/store.ts"
      via: "updateQuantity action"
      pattern: "updateQuantity"
    - from: "src/components/cart/remove-dialog.tsx"
      to: "src/lib/cart/store.ts"
      via: "removeItem action on confirm"
      pattern: "removeItem"
---

<objective>
Build the cart page at /cart displaying all cart items with their dimension configurations, per-item pricing, quantity management, removal with confirmation dialog, sticky checkout footer with subtotal, empty state, and mobile-responsive layout.

Purpose: This is the cart experience customers interact with before checkout. Without it, customers can add items but have no way to review, adjust, or proceed.
Output: Fully functional /cart page with item management, responsive layout, and checkout CTA.
</objective>

<execution_context>
@./.claude/get-shit-done/workflows/execute-plan.md
@./.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/04-cart-management/04-CONTEXT.md
@.planning/phases/04-cart-management/04-RESEARCH.md
@.planning/phases/04-cart-management/04-01-SUMMARY.md
@src/lib/cart/store.ts
@src/lib/cart/types.ts
</context>

<tasks>

<task type="auto">
  <name>Task 1: Cart page with item list, quantity controls, and removal dialog</name>
  <files>
    src/app/cart/page.tsx
    src/components/cart/cart-item.tsx
    src/components/cart/quantity-input.tsx
    src/components/cart/remove-dialog.tsx
  </files>
  <action>
    **src/components/cart/quantity-input.tsx** - Quantity stepper:
    - 'use client' component
    - Props: `quantity: number`, `onUpdate: (qty: number) => void`
    - Use text input with `inputMode="numeric"` and `pattern="[0-9]*"` (consistent with dimension inputs from Phase 3)
    - On change: parse integer, enforce min 1 max 999, call onUpdate with valid value
    - On blur: reset to last valid value if input is empty or invalid
    - Include minus/plus stepper buttons flanking the input for quick adjustment
    - Stepper buttons: `onClick` decrements/increments by 1, min 1 max 999
    - Accessible: `aria-label="Quantity"` on input, `aria-label="Decrease quantity"` / `aria-label="Increase quantity"` on buttons
    - Compact layout: inline-flex, buttons 32px square, input 48px wide, centered text

    **src/components/cart/remove-dialog.tsx** - Accessible confirmation dialog:
    - 'use client' component
    - Props: `productName: string`, `isOpen: boolean`, `onConfirm: () => void`, `onCancel: () => void`
    - Use native `<dialog>` element with `ref` and `showModal()` / `close()` for proper accessibility
    - When `isOpen` changes to true: call `dialogRef.current?.showModal()`
    - When `isOpen` changes to false: call `dialogRef.current?.close()`
    - Dialog content: "Remove from cart?" title, "Remove {productName} from your cart?" description
    - Two buttons: "Cancel" (secondary, closes dialog) and "Remove" (red/destructive, calls onConfirm)
    - ARIA: `role="alertdialog"`, `aria-labelledby`, `aria-describedby`
    - Handle Escape key (native dialog does this), handle backdrop click to close
    - Style dialog with `::backdrop` for overlay, centered content with max-w-sm

    **src/components/cart/cart-item.tsx** - Individual cart item card:
    - 'use client' component
    - Props: `item: CartItem` (from cart types)
    - Display: product name, dimensions as "100cm x 150cm" (original dimensions from item.options, NOT normalized)
    - Price per item: formatted with Intl.NumberFormat (same pattern as dimension-configurator)
    - Line total: priceInCents * quantity, also formatted
    - Render QuantityInput component wired to `useCartStore.updateQuantity`
    - Render "Remove" button that opens RemoveDialog, on confirm calls `useCartStore.removeItem`
    - Layout: Card-like with border, padding, flex row on desktop (info left, controls right), stack on mobile
    - Manage remove dialog open/closed state locally with useState

    **src/app/cart/page.tsx** - Cart page:
    - 'use client' page component (needs Zustand store access)
    - Use mount flag pattern for hydration safety
    - Read items from `useCartStore`
    - Before mounted: show loading skeleton or minimal layout (prevents hydration mismatch)
    - When mounted and items.length > 0: render list of CartItem components, then CartSummary (Task 2)
    - When mounted and items.length === 0: render empty state
    - Empty state: "Your cart is empty" message, "Continue Shopping" button that uses `router.back()` with fallback to "/" if no history (check `window.history.length > 1`)
    - Page title: "Your Cart" with item count
    - "Continue Shopping" link at top when items present (links to "/")
    - Max-width container (max-w-4xl mx-auto) with padding, consistent with product page layout
    - Add bottom padding (pb-32 or similar) to account for sticky footer not overlapping cart items
  </action>
  <verify>
    Run `npx tsc --noEmit` - no TypeScript errors.
    Navigate to /cart with items in cart:
    - Cart items display with product name, dimensions, price
    - Quantity input works (type new value, use +/- buttons)
    - Remove button opens dialog, Cancel closes it, Remove deletes item
    Navigate to /cart with empty cart:
    - Empty state message shows
    - Back button navigates away
  </verify>
  <done>
    Cart page renders all cart items with name, dimensions (original, not normalized), per-item price, line totals. Quantity can be changed via input or stepper buttons (min 1, max 999). Items can be removed after confirming in accessible dialog. Empty state shows when no items.
  </done>
</task>

<task type="auto">
  <name>Task 2: Sticky cart summary footer and mobile-responsive polish</name>
  <files>
    src/components/cart/cart-summary.tsx
    src/app/cart/page.tsx
  </files>
  <action>
    **src/components/cart/cart-summary.tsx** - Sticky footer with totals and CTA:
    - 'use client' component
    - Subscribe to `useCartStore` for getTotalPrice() and getItemCount()
    - Use mount flag for hydration safety
    - Display: "Subtotal ({N} items)" on left, formatted total price on right
    - "Proceed to Checkout" button: full-width, prominent blue-600 styling, min-h-[44px] for mobile tap target
    - Disabled when cart is empty (defensive, shouldn't render when empty but safe)
    - Checkout button is non-functional for now (Phase 5 wires it) - can show alert("Checkout coming soon") or simply do nothing
    - Sticky positioning: `fixed bottom-0 left-0 right-0` on mobile, with bg-white, border-t, shadow-lg, p-4
    - Content inside max-w-4xl mx-auto to match page width
    - z-10 to stay above page content

    **src/app/cart/page.tsx** - Wire CartSummary and finalize responsive layout:
    - Import and render CartSummary below the item list (only when items exist)
    - Ensure cart items have enough bottom padding to not be hidden behind sticky footer (pb-40 or similar)
    - Mobile responsive checks:
      - Cart items stack vertically on mobile (already handled in cart-item.tsx)
      - Quantity controls remain usable on small screens
      - Remove button accessible on mobile
      - Sticky footer doesn't overlap last item
    - Verify page works at narrow widths (320px viewport)
  </action>
  <verify>
    Run `npx tsc --noEmit` - no TypeScript errors.
    Run `npm run build` - production build succeeds.
    Full flow test:
    1. Go to /products/test-product, enter dimensions, add to cart
    2. Click cart icon in header to go to /cart
    3. See item with name, dimensions, price
    4. See sticky footer with subtotal and "Proceed to Checkout"
    5. Change quantity - subtotal updates
    6. Add another item with different dimensions from product page
    7. Cart shows 2 items with correct subtotal
    8. Remove one item (confirm dialog) - subtotal updates
    9. Remove last item - empty state appears, footer disappears
    10. Resize to mobile width - layout adapts, sticky footer usable
  </verify>
  <done>
    Sticky cart summary footer shows subtotal and item count with "Proceed to Checkout" button (non-functional until Phase 5). Cart page is mobile-responsive with proper spacing for sticky footer. Full add-review-manage flow works end to end.
  </done>
</task>

</tasks>

<verification>
1. `npx tsc --noEmit` passes with zero errors
2. `npm run build` produces successful production build
3. Cart page at /cart displays all items with correct data
4. Quantity management works (input + stepper buttons, min 1 max 999)
5. Remove confirmation dialog is accessible (keyboard nav, Escape to close, focus management)
6. Sticky footer shows correct subtotal, updates reactively
7. Empty state displays when cart has no items
8. Mobile layout: items stack, sticky footer has 44px+ tap target, no overlap issues
9. "Continue Shopping" link navigates back to products
</verification>

<success_criteria>
- /cart page renders with all cart items showing product name, original dimensions, and price
- Quantity controls work with stepper buttons and direct input
- Remove item requires confirmation dialog (accessible, native dialog element)
- Sticky footer shows subtotal and "Proceed to Checkout" (non-functional until Phase 5)
- Empty cart shows "Your cart is empty" with navigation back
- Mobile-responsive at 320px+ viewports
- TypeScript compiles, production build succeeds
</success_criteria>

<output>
After completion, create `.planning/phases/04-cart-management/04-02-SUMMARY.md`
</output>
