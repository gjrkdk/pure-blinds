---
phase: 19-bug-fixes
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - src/app/page.tsx
  - src/app/blog/[slug]/page.tsx
  - src/app/producten/[...slug]/page.tsx
  - src/app/layout.tsx
  - src/app/robots.ts
  - src/app/sitemap.ts
  - src/lib/env.ts
  - src/lib/schema/organization.ts
  - src/components/home/contact-section.tsx
  - data/pricing/roller-blind-white.json
  - data/pricing/roller-blind-black.json
  - data/pricing-matrix.json
  - .github/workflows/ci.yml
autonomous: true
requirements:
  - FIX-01
  - FIX-02
  - FIX-03
  - FIX-04

must_haves:
  truths:
    - "No source file references NEXT_PUBLIC_SITE_URL — all use NEXT_PUBLIC_BASE_URL"
    - "The app builds successfully without SHOPIFY_PRODUCT_ID in the environment"
    - "All pricing matrix JSON files declare currency EUR"
    - "All domain fallbacks resolve to pure-blinds.nl, not pureblinds.nl"
  artifacts:
    - path: "src/lib/env.ts"
      provides: "Env validation without dead SHOPIFY_PRODUCT_ID"
      contains: "SHOPIFY_STORE_DOMAIN"
    - path: "data/pricing/roller-blind-white.json"
      provides: "White roller blind pricing with EUR currency"
      contains: "\"currency\": \"EUR\""
    - path: "data/pricing/roller-blind-black.json"
      provides: "Black roller blind pricing with EUR currency"
      contains: "\"currency\": \"EUR\""
  key_links:
    - from: "src/app/page.tsx"
      to: "NEXT_PUBLIC_BASE_URL"
      via: "process.env lookup"
      pattern: "process\\.env\\.NEXT_PUBLIC_BASE_URL"
    - from: "src/app/layout.tsx"
      to: "pure-blinds.nl"
      via: "metadataBase fallback"
      pattern: "https://pure-blinds\\.nl"
---

<objective>
Fix four codebase bugs: replace stale NEXT_PUBLIC_SITE_URL with NEXT_PUBLIC_BASE_URL, remove dead SHOPIFY_PRODUCT_ID from env validation and CI, correct pricing matrix currency from USD to EUR, and update all domain fallbacks from pureblinds.nl to pure-blinds.nl.

Purpose: Eliminate env var inconsistencies, dead configuration, and incorrect metadata before production deployment.
Output: Clean codebase with consistent env vars, correct currency, and correct domain.
</objective>

<execution_context>
@/Users/robinkonijnendijk/.claude/get-shit-done/workflows/execute-plan.md
@/Users/robinkonijnendijk/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md

@src/lib/env.ts
@src/app/page.tsx
@src/app/layout.tsx
@src/app/blog/[slug]/page.tsx
@src/app/producten/[...slug]/page.tsx
@src/app/robots.ts
@src/app/sitemap.ts
@src/lib/schema/organization.ts
@src/components/home/contact-section.tsx
@data/pricing/roller-blind-white.json
@data/pricing/roller-blind-black.json
@data/pricing-matrix.json
@.github/workflows/ci.yml
</context>

<tasks>

<task type="auto">
  <name>Task 1: Fix env var references and remove dead config (FIX-01, FIX-02)</name>
  <files>
    src/app/page.tsx
    src/app/blog/[slug]/page.tsx
    src/app/producten/[...slug]/page.tsx
    src/lib/env.ts
    .github/workflows/ci.yml
  </files>
  <action>
**FIX-01 — Replace NEXT_PUBLIC_SITE_URL with NEXT_PUBLIC_BASE_URL in 3 files:**

1. `src/app/page.tsx` line 30: Change `process.env.NEXT_PUBLIC_SITE_URL` to `process.env.NEXT_PUBLIC_BASE_URL`. Also update the fallback domain to `'https://pure-blinds.nl'` (addresses FIX-04 simultaneously).

2. `src/app/blog/[slug]/page.tsx` line 11: Change `process.env.NEXT_PUBLIC_SITE_URL` to `process.env.NEXT_PUBLIC_BASE_URL`. Also update the fallback domain to `'https://pure-blinds.nl'`.

3. `src/app/producten/[...slug]/page.tsx` line 17: Change `process.env.NEXT_PUBLIC_SITE_URL` to `process.env.NEXT_PUBLIC_BASE_URL`. Also update the fallback domain to `'https://pure-blinds.nl'`.

**FIX-02 — Remove dead SHOPIFY_PRODUCT_ID:**

4. `src/lib/env.ts` line 9: Remove the entire `SHOPIFY_PRODUCT_ID: z.string().min(1, "SHOPIFY_PRODUCT_ID is required"),` line from the Zod envSchema object. This env var is no longer used anywhere in source code (product IDs come from the catalog since Phase 11).

5. `.github/workflows/ci.yml` line 71: Remove `SHOPIFY_PRODUCT_ID: ${{ secrets.SHOPIFY_PRODUCT_ID }}` from the build job env block.

**Verification after changes:**
- Grep the entire `src/` directory for `NEXT_PUBLIC_SITE_URL` — expect zero matches.
- Grep the entire `src/` directory for `SHOPIFY_PRODUCT_ID` — expect zero matches.
  </action>
  <verify>
Run: `grep -r "NEXT_PUBLIC_SITE_URL" src/` — must return zero results.
Run: `grep -r "SHOPIFY_PRODUCT_ID" src/` — must return zero results.
Run: `grep "SHOPIFY_PRODUCT_ID" .github/workflows/ci.yml` — must return zero results.
Run: `npx tsc --noEmit` — must pass (no type errors from env changes).
  </verify>
  <done>No source file references NEXT_PUBLIC_SITE_URL. No source file or CI config references SHOPIFY_PRODUCT_ID. TypeScript compilation succeeds.</done>
</task>

<task type="auto">
  <name>Task 2: Correct pricing currency and domain fallbacks (FIX-03, FIX-04)</name>
  <files>
    data/pricing/roller-blind-white.json
    data/pricing/roller-blind-black.json
    data/pricing-matrix.json
    src/app/layout.tsx
    src/app/robots.ts
    src/app/sitemap.ts
    src/lib/schema/organization.ts
    src/components/home/contact-section.tsx
  </files>
  <action>
**FIX-03 — Correct currency metadata from USD to EUR in all 3 pricing JSON files:**

1. `data/pricing/roller-blind-white.json` line 5: Change `"currency": "USD"` to `"currency": "EUR"`.
2. `data/pricing/roller-blind-black.json` line 5: Change `"currency": "USD"` to `"currency": "EUR"`.
3. `data/pricing-matrix.json` line 5: Change `"currency": "USD"` to `"currency": "EUR"`.

Note: This is metadata only — the pricing engine already uses EUR in Shopify Draft Orders (per Phase 5 decision). The JSON metadata was never updated to match.

**FIX-04 — Correct domain fallback from pureblinds.nl to pure-blinds.nl in all source files:**

4. `src/app/layout.tsx` line 13: Change `'https://pureblinds.nl'` to `'https://pure-blinds.nl'` in the metadataBase fallback.

5. `src/app/robots.ts` line 4: Change `'https://pureblinds.nl'` to `'https://pure-blinds.nl'` in the baseUrl fallback.

6. `src/app/sitemap.ts` line 6: Change `'https://pureblinds.nl'` to `'https://pure-blinds.nl'` in the baseUrl fallback.

7. `src/lib/schema/organization.ts` line 10: Change `'info@pureblinds.nl'` to `'info@pure-blinds.nl'` in the Organization schema email.

8. `src/components/home/contact-section.tsx` lines 90 and 93: Change both occurrences of `pureblinds.nl` to `pure-blinds.nl` (the mailto href and the visible email text).

Note: The 3 files from Task 1 (page.tsx, blog slug page, product slug page) already have their domain fallbacks updated in Task 1. Do NOT touch those files again here.

**Verification after changes:**
- Grep `src/` for `pureblinds.nl` — expect zero matches (all replaced with `pure-blinds.nl`).
- Grep `data/` for `"currency": "USD"` — expect zero matches.
  </action>
  <verify>
Run: `grep -r "pureblinds\.nl" src/` — must return zero results.
Run: `grep -r '"currency": "USD"' data/` — must return zero results.
Run: `grep -r '"currency": "EUR"' data/` — must return 3 results (one per JSON file).
Run: `npx tsc --noEmit` — must pass.
  </verify>
  <done>All pricing JSON files declare "currency": "EUR". All source domain fallbacks and email addresses use pure-blinds.nl. TypeScript compilation succeeds.</done>
</task>

</tasks>

<verification>
1. `grep -r "NEXT_PUBLIC_SITE_URL" src/` returns nothing
2. `grep -r "SHOPIFY_PRODUCT_ID" src/ .github/` returns nothing
3. `grep -r '"currency": "USD"' data/` returns nothing
4. `grep -r "pureblinds\.nl" src/` returns nothing
5. `npx tsc --noEmit` passes
6. `npm run build` succeeds (full build validation)
</verification>

<success_criteria>
- Zero references to NEXT_PUBLIC_SITE_URL in source code
- Zero references to SHOPIFY_PRODUCT_ID in source code and CI
- All 3 pricing JSON files declare "currency": "EUR"
- All domain fallbacks use pure-blinds.nl
- All email addresses use @pure-blinds.nl
- TypeScript compiles without errors
- Next.js build succeeds
</success_criteria>

<output>
After completion, create `.planning/phases/19-bug-fixes/19-01-SUMMARY.md`
</output>
