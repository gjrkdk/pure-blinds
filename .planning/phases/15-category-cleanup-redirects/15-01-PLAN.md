---
phase: 15-category-cleanup-redirects
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - next.config.mjs
  - data/products.json
  - data/pricing/venetian-blinds-25mm.json
  - data/pricing/custom-textile.json
  - src/app/products/venetian-blinds/page.tsx
  - src/app/products/textiles/page.tsx
  - src/lib/product/types.ts
  - src/lib/product/catalog.ts
  - src/lib/product/data.ts
  - src/lib/cart/store.ts
  - src/app/products/page.tsx
  - src/components/layout/footer.tsx
autonomous: true

must_haves:
  truths:
    - "Visiting /products/venetian-blinds returns a 301 redirect to /products"
    - "Visiting /products/venetian-blinds/venetian-blinds-25mm returns a 301 redirect to /products"
    - "Visiting /products/textiles returns a 301 redirect to /products"
    - "Visiting /products/textiles/custom-textile returns a 301 redirect to /products"
    - "Product catalog contains exactly 2 products (roller-blind-white, roller-blind-black)"
    - "Products overview page shows only 1 category card (Roller Blinds)"
    - "Footer contains no links to venetian-blinds or textiles"
    - "Cart migration silently removes items for deleted products on load"
    - "TypeScript types enforce roller-blinds as only valid category"
  artifacts:
    - path: "next.config.mjs"
      provides: "301 redirects for removed category and product URLs"
      contains: "venetian-blinds"
    - path: "data/products.json"
      provides: "Product catalog with only roller-blinds products"
    - path: "src/lib/product/types.ts"
      provides: "Narrowed Category and Subcategory literal union types"
      contains: "roller-blinds"
    - path: "src/lib/cart/store.ts"
      provides: "Version 4 cart migration filtering invalid products"
      contains: "version: 4"
  key_links:
    - from: "next.config.mjs"
      to: "/products"
      via: "redirect destination"
      pattern: "destination.*products"
    - from: "src/lib/cart/store.ts"
      to: "src/lib/product/catalog.ts"
      via: "getProduct lookup for migration"
      pattern: "getProduct"
---

<objective>
Remove venetian-blinds and textiles categories from all infrastructure: redirects, data files, route files, product types, cart migration, products page, and footer navigation.

Purpose: Eliminate non-rollerblind categories while preserving SEO equity through 301 redirects and preventing stale cart items from breaking checkout.
Output: Clean infrastructure with only roller-blinds products remaining, all old URLs redirecting properly.
</objective>

<execution_context>
@/Users/robinkonijnendijk/.claude/get-shit-done/workflows/execute-plan.md
@/Users/robinkonijnendijk/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/15-category-cleanup-redirects/15-RESEARCH.md
@next.config.mjs
@data/products.json
@src/lib/product/types.ts
@src/lib/product/catalog.ts
@src/lib/product/data.ts
@src/lib/cart/store.ts
@src/app/products/page.tsx
@src/components/layout/footer.tsx
</context>

<tasks>

<task type="auto">
  <name>Task 1: Add 301 redirects, delete routes and pricing data, update product catalog</name>
  <files>
    next.config.mjs
    data/products.json
    data/pricing/venetian-blinds-25mm.json
    data/pricing/custom-textile.json
    src/app/products/venetian-blinds/page.tsx
    src/app/products/textiles/page.tsx
  </files>
  <action>
1. **next.config.mjs** — Add redirects for all removed URLs. Per user decision, use 301 (not 308). Next.js `permanent: true` defaults to 308, so use `statusCode: 301` property instead of `permanent: true`. Add these redirects to the existing redirects array:
   - `/products/venetian-blinds` -> `/products` (statusCode: 301)
   - `/products/venetian-blinds/:path*` -> `/products` (statusCode: 301)
   - `/products/textiles` -> `/products` (statusCode: 301)
   - `/products/textiles/:path*` -> `/products` (statusCode: 301)

   Format for 301 explicitly:
   ```js
   {
     source: '/products/venetian-blinds',
     destination: '/products',
     statusCode: 301,
   }
   ```
   Note: When using `statusCode`, do NOT include `permanent` property (they are mutually exclusive in Next.js).

2. **Delete route directories** — Remove entire directories:
   - `rm -rf src/app/products/venetian-blinds/`
   - `rm -rf src/app/products/textiles/`

3. **Delete pricing matrix files:**
   - `rm data/pricing/venetian-blinds-25mm.json`
   - `rm data/pricing/custom-textile.json`

4. **data/products.json** — Remove the `venetian-blinds-25mm` and `custom-textile` product objects from the products array. Update `lastUpdated` to `"2026-02-14"`. Only `roller-blind-white` and `roller-blind-black` should remain (2 products total).

5. Verify with `npm run build` that the app compiles without errors and redirects are recognized.
  </action>
  <verify>
Run `npm run build` to verify no compilation errors. Then start dev server and test with curl:
- `curl -I http://localhost:3000/products/venetian-blinds` should return 301 redirect to /products
- `curl -I http://localhost:3000/products/textiles` should return 301 redirect to /products
- `curl -I http://localhost:3000/products/venetian-blinds/venetian-blinds-25mm` should return 301 redirect to /products
- `curl -I http://localhost:3000/products/textiles/custom-textile` should return 301 redirect to /products
  </verify>
  <done>All removed category/product URLs return 301 redirects to /products. Route directories and pricing files deleted. Product catalog contains exactly 2 roller-blind products.</done>
</task>

<task type="auto">
  <name>Task 2: Narrow TypeScript types, update catalog functions, add cart migration, clean products page and footer</name>
  <files>
    src/lib/product/types.ts
    src/lib/product/catalog.ts
    src/lib/product/data.ts
    src/lib/cart/store.ts
    src/app/products/page.tsx
    src/components/layout/footer.tsx
  </files>
  <action>
1. **src/lib/product/types.ts** — Add literal union types and update the Product interface:
   ```typescript
   export type Category = 'roller-blinds';
   export type Subcategory = 'transparent-roller-blinds' | 'blackout-roller-blinds';

   export interface Product {
     id: string;
     name: string;
     slug: string;
     category: Category;
     subcategory?: Subcategory;
     description: string;
     pricingMatrixPath: string;
     shopifyProductId: string;
     shopifyVariantId: string;
     details: { label: string; value: string }[];
   }
   ```

2. **src/lib/product/catalog.ts** — Update function signatures to use the new types:
   - `getProductsByCategory(category: Category)` instead of `category: string`
   - `getProductsBySubcategory(category: Category, subcategory: Subcategory)` instead of strings
   - Import `Category` and `Subcategory` types from `./types`

3. **src/lib/product/data.ts** — Update the `getProductsByCategory` call and `ProductData` interface:
   - `category` field type should use `Category` (import from `./types`)
   - `getProductsByCategory(category: Category)` function signature

4. **src/lib/cart/store.ts** — Bump version from 3 to 4 and add migration:
   - Import `getProduct` from `@/lib/product/catalog`
   - Change `version: 3` to `version: 4`
   - Add version 4 migration after existing version 3 migration. The v4 migration filters cart items to only those whose `productId` resolves to an existing product via `getProduct()`. If item count changes, log a warning.
   - Keep the existing `version < 3` migration as-is (it clears everything).
   - For `version < 4` (but >= 3): filter items where `getProduct(item.productId)` returns undefined.

5. **src/app/products/page.tsx** — Remove venetian-blinds and textiles category objects from the `categories` array. Only the Roller Blinds entry should remain.

6. **src/components/layout/footer.tsx** — Remove the links for "Venetian Blinds" (href: `/products/venetian-blinds`) and "Textiles" (href: `/products/textiles`) from the links array. Keep "Roller Blinds", "Blog", "About us", "Contact".
  </action>
  <verify>
Run `npm run build` to verify TypeScript compilation with narrowed types — no type errors.
Verify that no code references `'venetian-blinds'` or `'textiles'` as category values (grep should find zero matches in .ts/.tsx files, excluding test/config/planning files).
  </verify>
  <done>TypeScript types enforce roller-blinds as only valid category. Cart version 4 migration filters invalid products. Products page shows 1 category. Footer shows only valid links.</done>
</task>

</tasks>

<verification>
1. `npm run build` completes without TypeScript or compilation errors
2. All 4 redirect URLs return HTTP 301 to /products (test with curl -I in dev server)
3. `data/products.json` contains exactly 2 products
4. `data/pricing/` contains exactly 2 files (roller-blind-white.json, roller-blind-black.json)
5. No route directories exist for venetian-blinds or textiles
6. `grep -ri "venetian\|textiles" src/lib/product/` returns no matches
7. Products page renders single Roller Blinds category card
8. Footer contains no removed category links
</verification>

<success_criteria>
- Venetian blinds completely removed from data, routes, types, and navigation
- Textiles completely removed from data, routes, types, and navigation
- All removed URLs return 301 redirects to /products
- Cart migration handles stale items silently
- TypeScript enforces roller-blinds-only catalog at compile time
- Application builds and runs without errors
</success_criteria>

<output>
After completion, create `.planning/phases/15-category-cleanup-redirects/15-01-SUMMARY.md`
</output>
