---
phase: 13-blog-foundation-content-marketing
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - velite.config.ts
  - next.config.mjs
  - tsconfig.json
  - .gitignore
  - package.json
  - src/app/globals.css
  - content/posts/choosing-blinds-guide.mdx
  - content/posts/blind-care-tips.mdx
  - content/posts/measuring-windows.mdx
  - src/components/mdx/mdx-content.tsx
  - src/app/blog/page.tsx
  - src/app/blog/[slug]/page.tsx
autonomous: true

must_haves:
  truths:
    - "User can view blog listing page at /blog with grid of post cards"
    - "Each blog card shows title, excerpt, date, and reading time"
    - "User can click a blog card to navigate to /blog/[slug]"
    - "Blog post detail page renders full MDX content with formatted typography"
    - "System includes 2-3 sample blog posts managed via Velite MDX"
    - "Blog post detail pages are responsive with good typography"
    - "Footer includes links to product categories and blog"
  artifacts:
    - path: "velite.config.ts"
      provides: "Velite content collection schema with reading time"
      contains: "defineCollection"
    - path: "next.config.mjs"
      provides: "Velite build integration with Next.js"
      contains: "velite"
    - path: "content/posts/choosing-blinds-guide.mdx"
      provides: "Sample blog post - buying guide"
    - path: "content/posts/blind-care-tips.mdx"
      provides: "Sample blog post - care instructions"
    - path: "content/posts/measuring-windows.mdx"
      provides: "Sample blog post - measuring guide"
    - path: "src/components/mdx/mdx-content.tsx"
      provides: "Client-side MDX renderer component"
      contains: "use client"
    - path: "src/app/blog/page.tsx"
      provides: "Blog listing page with post grid"
      contains: "posts"
    - path: "src/app/blog/[slug]/page.tsx"
      provides: "Blog post detail page with MDX rendering"
      contains: "generateStaticParams"
  key_links:
    - from: "velite.config.ts"
      to: "content/posts/*.mdx"
      via: "Velite collection pattern"
      pattern: "posts/\\*\\*/\\*.mdx"
    - from: "src/app/blog/page.tsx"
      to: ".velite"
      via: "import posts from generated data"
      pattern: "from.*\\.velite"
    - from: "src/app/blog/[slug]/page.tsx"
      to: "src/components/mdx/mdx-content.tsx"
      via: "MDXContent component renders post body"
      pattern: "MDXContent"
    - from: "next.config.mjs"
      to: "velite"
      via: "build integration triggers Velite on dev/build"
      pattern: "build.*velite"
---

<objective>
Set up Velite-based blog with type-safe MDX content management, sample blog posts, and complete listing/detail pages.

Purpose: Deliver blog foundation with 2-3 sample posts (buying guides, care instructions) that users can browse from `/blog` and read at `/blog/[slug]` with responsive, well-formatted typography.

Output: Working blog with Velite content pipeline, 3 sample MDX posts, blog listing page with card grid, and blog post detail page with prose typography.
</objective>

<execution_context>
@/Users/robinkonijnendijk/.claude/get-shit-done/workflows/execute-plan.md
@/Users/robinkonijnendijk/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/13-blog-foundation-content-marketing/13-RESEARCH.md
@src/app/blog/page.tsx
@src/components/layout/breadcrumbs.tsx
@src/components/layout/footer.tsx
@src/app/globals.css
@next.config.ts
@tsconfig.json
@.gitignore
@package.json
@postcss.config.mjs
</context>

<tasks>

<task type="auto">
  <name>Task 1: Velite infrastructure, config, and sample blog content</name>
  <files>
    package.json
    velite.config.ts
    next.config.mjs
    tsconfig.json
    .gitignore
    src/app/globals.css
    content/posts/choosing-blinds-guide.mdx
    content/posts/blind-care-tips.mdx
    content/posts/measuring-windows.mdx
  </files>
  <action>
**Install dependencies:**
```bash
npm install velite reading-time date-fns
npm install -D @tailwindcss/typography
```

**Create velite.config.ts** in project root:
- Define a `posts` collection with pattern `posts/**/*.mdx`
- Schema: `title` (string, max 99), `slug` (s.slug('blog')), `date` (s.isodate()), `excerpt` (s.excerpt()), `body` (s.mdx())
- Transform to add `readingTime` using `reading-time` package (returns text like "3 min read") and `permalink` as `/blog/${slug}`
- Output config: data to `.velite`, assets to `public/static`, base `/static/`, name pattern `[name]-[hash:6].[ext]`, clean true
- Root: `content`
- See research Pattern 1 for exact implementation

**Convert next.config.ts to next.config.mjs:**
- DELETE `next.config.ts` (critical: file must be removed, not just renamed)
- CREATE `next.config.mjs` with ESM syntax (required for top-level await)
- Use `import { build } from 'velite'` at top
- Use `process.argv.includes('dev')` and `process.argv.includes('build')` to detect mode
- Call `await build({ watch: isDev, clean: !isDev })` before exporting config
- Export empty nextConfig object (existing config has no custom options)
- See research Pattern 2 for exact implementation

**Update tsconfig.json:**
- Add path alias `"#content/*": ["./.velite/*"]` in `compilerOptions.paths` so blog pages can import generated Velite data
- NOTE: Do NOT use `@/.velite` since `@/*` maps to `./src/*` and .velite is in project root. Use a separate path alias.
- Add `.velite` to the `include` array so TypeScript recognizes the generated files

**Update .gitignore:**
- Add `.velite` entry (generated Velite output)
- Add `public/static` entry (Velite-processed assets)

**Enable @tailwindcss/typography for Tailwind v4:**
- In `src/app/globals.css`, add `@plugin "@tailwindcss/typography";` after the `@import "tailwindcss";` line
- This is the Tailwind v4 way to load plugins (NOT via tailwind.config.js which doesn't exist)

**Create 3 sample blog posts** in `content/posts/`:

1. `choosing-blinds-guide.mdx` - "The Complete Guide to Choosing Window Blinds"
   - Date: 2025-01-15
   - ~400 words covering blind types (roller, venetian, textile), factors to consider (light control, privacy, aesthetics), and a buying checklist
   - Use h2 and h3 headings, bullet lists, bold text, numbered lists

2. `blind-care-tips.mdx` - "How to Care for Your Window Blinds"
   - Date: 2025-02-10
   - ~350 words covering cleaning methods by material, maintenance schedule, common mistakes to avoid
   - Use h2 headings, numbered lists, bold tips

3. `measuring-windows.mdx` - "How to Measure Your Windows for Perfect-Fit Blinds"
   - Date: 2025-03-05
   - ~300 words covering tools needed, step-by-step measurement process, inside vs outside mount
   - Use h2 headings, ordered lists, bold callouts

Each MDX file has frontmatter with title, slug (matching filename without extension), date, and an excerpt field that provides 1-2 sentence summary. The body content should be substantive placeholder content relevant to a blinds/textiles business.
  </action>
  <verify>
1. `ls velite.config.ts` - file exists
2. `ls next.config.mjs` - file exists (and `ls next.config.ts` should fail)
3. `ls content/posts/` - shows 3 .mdx files
4. `grep "velite" .gitignore` - shows .velite entry
5. `grep "public/static" .gitignore` - shows public/static entry
6. `grep "#content" tsconfig.json` - shows path alias
7. `grep "@plugin" src/app/globals.css` - shows typography plugin
8. `npx velite` - runs without errors and generates .velite directory
  </verify>
  <done>
Velite builds successfully from 3 MDX sample posts, next.config.mjs integrates Velite with Next.js build, tsconfig has path alias for .velite imports, .gitignore excludes generated files, and @tailwindcss/typography is loaded via Tailwind v4 @plugin directive.
  </done>
</task>

<task type="auto">
  <name>Task 2: Blog listing page, post detail page, and MDX renderer</name>
  <files>
    src/components/mdx/mdx-content.tsx
    src/app/blog/page.tsx
    src/app/blog/[slug]/page.tsx
  </files>
  <action>
**Create MDX content renderer** at `src/components/mdx/mdx-content.tsx`:
- Mark as `'use client'` (required: Function() constructor needs client-side execution)
- Import `* as runtime from 'react/jsx-runtime'`
- Create `useMDXComponent` function that takes code string, creates Function from it, calls with runtime, returns default export
- Export `MDXContent` component accepting `{ code: string }` prop
- Pass `components` object with `Image` from `next/image` for potential MDX image usage
- See research Pattern 5 for exact implementation

**Replace blog listing page** at `src/app/blog/page.tsx`:
- This is a Server Component (NO 'use client' - Velite data is imported at build time)
- Import `posts` from `#content` (using the tsconfig path alias for .velite)
- Import `format` from `date-fns` for date formatting
- Import `Link` from `next/link` and `Breadcrumbs` from `@/components/layout/breadcrumbs`
- Sort posts by date descending (newest first) - Velite returns filesystem order, not date order
- Render breadcrumbs: Home > Blog (current)
- Page header with "Blog" eyebrow text (uppercase, tracking-wider, text-muted), "Guides & Tips" as h1 (text-3xl font-light tracking-tight sm:text-4xl)
- Responsive grid: `grid gap-8 sm:grid-cols-2 lg:grid-cols-3`
- Each post card is a Link wrapping an article with:
  - `border border-neutral-200 rounded-lg p-6 hover:border-neutral-300 transition-colors` (matches existing card patterns)
  - Date formatted as "MMMM d, yyyy" (e.g., "January 15, 2025")
  - Title as h2 (text-xl font-semibold with group-hover color transition)
  - Excerpt with `line-clamp-3` for consistent card heights
  - Reading time in footer area separated by `border-t border-neutral-100`
- See research Pattern 3 for reference implementation

**Create blog post detail page** at `src/app/blog/[slug]/page.tsx`:
- Server Component (NO 'use client')
- Import `posts` from `#content`, `notFound` from `next/navigation`, `format` from `date-fns`
- Import `Breadcrumbs` from `@/components/layout/breadcrumbs` and `MDXContent` from `@/components/mdx/mdx-content`
- Export `generateStaticParams` returning all post slugs (required for SSG)
- Export `generateMetadata` returning title and description from post data
- In page component: await params, find post by slug, call notFound() if missing
- Breadcrumbs: Home > Blog > Post Title (current)
- Article header: date + reading time on one line (text-sm text-muted), title as h1 (text-4xl font-light tracking-tight sm:text-5xl), excerpt as subtitle (text-lg text-muted)
- Content wrapper: `prose prose-neutral max-w-none` for @tailwindcss/typography styling
  - Add responsive sizing: `md:prose-lg` for larger screens
  - Add custom heading styles: `prose-headings:font-semibold prose-headings:tracking-tight`
- Max content width: `max-w-3xl mx-auto` for optimal reading line length
- Wrap MDXContent with the prose div
- See research Pattern 4 for reference implementation

**Important Next.js 16+ note:** The `params` prop in page components is a Promise. Use `const { slug } = await params` pattern in both generateMetadata and the page component.
  </action>
  <verify>
1. `npx next build` - builds without errors
2. Build output includes `/blog` as static route
3. Build output includes `/blog/choosing-blinds-guide`, `/blog/blind-care-tips`, `/blog/measuring-windows` as static routes
4. `grep "generateStaticParams" src/app/blog/\\[slug\\]/page.tsx` - SSG function present
5. `grep "prose" src/app/blog/\\[slug\\]/page.tsx` - typography classes present
6. `grep "use client" src/components/mdx/mdx-content.tsx` - MDX renderer is client component
7. `grep "line-clamp" src/app/blog/page.tsx` - excerpt truncation present
  </verify>
  <done>
Blog listing page at /blog shows responsive grid of 3 post cards with title, excerpt, date, and reading time. Clicking a card navigates to /blog/[slug] where full MDX content renders with prose typography. All blog pages build as static routes via generateStaticParams. MDXContent renderer handles Velite-compiled MDX code.
  </done>
</task>

</tasks>

<verification>
1. `npx next build` completes without errors
2. Blog listing page exists at `/blog` with post grid
3. Blog post detail pages exist at `/blog/choosing-blinds-guide`, `/blog/blind-care-tips`, `/blog/measuring-windows`
4. Each blog card displays: title, excerpt, formatted date, reading time
5. Blog post detail renders formatted MDX content with prose typography
6. Footer already contains links to product categories (Rollerblinds, Venetian Blinds, Textiles) and Blog (verified from Phase 12)
7. All blog pages are Server Components except MDXContent renderer
8. generateStaticParams exports on [slug] page for SSG

**Pre-satisfied requirements:**
- NAV-06 (Footer links to product categories): Already implemented in Phase 12 - footer.tsx has Rollerblinds, Venetian Blinds, Textiles links
- NAV-07 (Footer includes link to blog): Already implemented in Phase 12 - footer.tsx has Blog link to /blog
</verification>

<success_criteria>
1. User can view blog listing page at `/blog` with grid of blog posts showing title, excerpt, date, and reading time
2. User can click blog post card to view full post with formatted content
3. System includes 3 sample blog posts (buying guide, care tips, measuring guide) managed via Velite MDX
4. Blog post detail pages are responsive with good typography (prose classes)
5. Footer includes links to product categories and blog (pre-satisfied from Phase 12)
</success_criteria>

<output>
After completion, create `.planning/phases/13-blog-foundation-content-marketing/13-01-SUMMARY.md`
</output>
