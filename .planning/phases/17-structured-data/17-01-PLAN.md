---
phase: 17-structured-data
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - package.json
  - src/lib/schema/jsonld.tsx
  - src/lib/schema/organization.ts
  - src/lib/schema/faq.ts
  - src/lib/schema/product.ts
  - src/lib/schema/breadcrumb.ts
  - src/lib/schema/blog.ts
  - src/app/page.tsx
  - src/components/home/faq-section.tsx
autonomous: true

must_haves:
  truths:
    - "Homepage HTML contains Organization JSON-LD script tag with Pure Blinds name and EUR context"
    - "Homepage HTML contains FAQPage JSON-LD script tag with all FAQ questions and answers"
    - "All JSON-LD output escapes < characters as \\u003c to prevent XSS"
  artifacts:
    - path: "src/lib/schema/jsonld.tsx"
      provides: "Reusable JsonLd component with XSS escaping"
      contains: "replace(/</g"
    - path: "src/lib/schema/organization.ts"
      provides: "Organization schema builder"
      contains: "buildOrganizationSchema"
    - path: "src/lib/schema/faq.ts"
      provides: "FAQPage schema builder"
      contains: "buildFaqSchema"
    - path: "src/lib/schema/product.ts"
      provides: "Product schema builder"
      contains: "buildProductSchema"
    - path: "src/lib/schema/breadcrumb.ts"
      provides: "BreadcrumbList schema builder"
      contains: "buildBreadcrumbSchema"
    - path: "src/lib/schema/blog.ts"
      provides: "BlogPosting schema builder"
      contains: "buildBlogPostSchema"
  key_links:
    - from: "src/app/page.tsx"
      to: "src/lib/schema/jsonld.tsx"
      via: "JsonLd component import"
      pattern: "import.*JsonLd.*from.*@/lib/schema/jsonld"
    - from: "src/app/page.tsx"
      to: "src/lib/schema/organization.ts"
      via: "buildOrganizationSchema call"
      pattern: "buildOrganizationSchema"
    - from: "src/app/page.tsx"
      to: "src/lib/schema/faq.ts"
      via: "buildFaqSchema call"
      pattern: "buildFaqSchema"
---

<objective>
Create Schema.org JSON-LD infrastructure and wire Organization + FAQPage schemas into the homepage.

Purpose: Establish reusable schema builder pattern and deliver first two schema types on homepage for Google Knowledge Panel eligibility and FAQ rich results.
Output: All 5 schema builder functions ready for use, plus Organization and FAQPage schemas live on homepage.
</objective>

<execution_context>
@/Users/robinkonijnendijk/.claude/get-shit-done/workflows/execute-plan.md
@/Users/robinkonijnendijk/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/17-structured-data/17-RESEARCH.md
@src/app/page.tsx
@src/components/home/faq-section.tsx
@src/lib/product/types.ts
@src/lib/pricing/types.ts
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create schema infrastructure — JsonLd component and all 5 builder functions</name>
  <files>
    package.json
    src/lib/schema/jsonld.tsx
    src/lib/schema/organization.ts
    src/lib/schema/faq.ts
    src/lib/schema/product.ts
    src/lib/schema/breadcrumb.ts
    src/lib/schema/blog.ts
  </files>
  <action>
    1. Install schema-dts: `npm install schema-dts`

    2. Create `src/lib/schema/jsonld.tsx` — Reusable JsonLd React component:
       - Generic component `JsonLd<T extends Thing>` accepting `{ data: WithContext<T> }`
       - Renders `<script type="application/ld+json">` with `dangerouslySetInnerHTML`
       - XSS protection: `JSON.stringify(data).replace(/</g, '\\u003c')`
       - Import Thing, WithContext from 'schema-dts'
       - This is a Server Component (no 'use client')

    3. Create `src/lib/schema/organization.ts` — Organization schema builder:
       - Export `buildOrganizationSchema(baseUrl: string): WithContext<Organization>`
       - Name: "Pure Blinds"
       - URL: baseUrl
       - Logo: `${baseUrl}/svg/logo.svg`
       - Email: "info@pureblinds.nl"
       - No phone number (per user decision)

    4. Create `src/lib/schema/faq.ts` — FAQPage schema builder:
       - Export interface `FaqItem { question: string; answer: string }`
       - Export `buildFaqSchema(items: FaqItem[]): WithContext<FAQPage>`
       - Maps items to Question/Answer pairs with name and acceptedAnswer

    5. Create `src/lib/schema/product.ts` — Product schema builder:
       - Import Product type from `@/lib/product/types` and PricingMatrixData from `@/lib/pricing/types`
       - Export `buildProductSchema(product: Product, pricingMatrix: PricingMatrixData, baseUrl: string): WithContext<ProductSchema>`
       - Calculate minimum price: `Math.min(...pricingMatrix.matrix.flat())` divided by 100, formatted to 2 decimals
       - Use EUR currency (hardcoded per user decision, NOT matrix.currency which says USD)
       - Availability: `https://schema.org/InStock`
       - ItemCondition: `https://schema.org/NewCondition`
       - Brand: `{ '@type': 'Brand', name: 'Pure Blinds' }`
       - Product URL: `${baseUrl}/products/${product.category}/${product.subcategory}/${product.slug}` (all products have subcategory)
       - Include product name, description
       - Note: schema-dts exports Product as `Product` which collides with our Product type. Use `import { Product as SchemaProduct } from 'schema-dts'` or `import type { Product as ProductType } from '@/lib/product/types'`

    6. Create `src/lib/schema/breadcrumb.ts` — BreadcrumbList schema builder:
       - Export interface `BreadcrumbItem { label: string; href?: string; current?: boolean }`
       - Export `buildBreadcrumbSchema(items: BreadcrumbItem[], baseUrl: string): WithContext<BreadcrumbList>`
       - Maps items to ListItem with position starting at 1 (index + 1)
       - For items with href: `item: ${baseUrl}${item.href}`
       - For current/no-href items: omit `item` property (last breadcrumb is current page name only)

    7. Create `src/lib/schema/blog.ts` — BlogPosting schema builder:
       - Export interface matching Velite post shape: `{ title: string; excerpt: string; date: string; slug: string; readingTime: string }`
       - Export `buildBlogPostSchema(post: BlogPostData, baseUrl: string): WithContext<BlogPosting>`
       - headline: post.title
       - description: post.excerpt
       - datePublished: post.date
       - author: `{ '@type': 'Organization', name: 'Pure Blinds' }`
       - publisher: `{ '@type': 'Organization', name: 'Pure Blinds', logo: { '@type': 'ImageObject', url: '${baseUrl}/svg/logo.svg' } }`
       - url: `${baseUrl}/blog/${post.slug}`
  </action>
  <verify>
    Run `npx tsc --noEmit` — all schema files must compile without TypeScript errors.
    Run `npm run build` — verify no build errors.
  </verify>
  <done>
    schema-dts installed, JsonLd component created, all 5 builder functions created with correct types and XSS protection.
  </done>
</task>

<task type="auto">
  <name>Task 2: Wire Organization and FAQPage schemas into homepage</name>
  <files>
    src/components/home/faq-section.tsx
    src/app/page.tsx
  </files>
  <action>
    1. Extract FAQ data from `src/components/home/faq-section.tsx`:
       - Move the `FAQ_ITEMS` array to a module-level export: `export const FAQ_ITEMS = [...]`
       - The FaqSection component keeps using FAQ_ITEMS directly (it's in the same file, still works)
       - This allows page.tsx to import FAQ_ITEMS for schema generation

    2. Update `src/app/page.tsx` to add Organization + FAQPage schemas:
       - Import `{ JsonLd }` from `@/lib/schema/jsonld`
       - Import `{ buildOrganizationSchema }` from `@/lib/schema/organization`
       - Import `{ buildFaqSchema }` from `@/lib/schema/faq`
       - Import `{ FAQ_ITEMS }` from `@/components/home/faq-section`
       - Define base URL: `const BASE_URL = process.env.NEXT_PUBLIC_SITE_URL || 'https://pureblinds.nl'`
       - Build organization schema: `const orgSchema = buildOrganizationSchema(BASE_URL)`
       - Build FAQ schema: `const faqSchema = buildFaqSchema(FAQ_ITEMS)`
       - Add two `<JsonLd>` components at the top of the return JSX (inside the fragment):
         ```tsx
         <JsonLd data={orgSchema} />
         <JsonLd data={faqSchema} />
         ```
       - IMPORTANT: page.tsx is a Server Component (no 'use client'), so it can import from 'use client' components (FAQ_ITEMS export) and render Server Components (JsonLd)
  </action>
  <verify>
    Run `npm run build` — verify no build errors.
    Run `npm run dev` and check page source (View Source) for the homepage — verify two `<script type="application/ld+json">` tags present.
    First script should contain `"@type":"Organization"` with `"name":"Pure Blinds"`.
    Second script should contain `"@type":"FAQPage"` with mainEntity containing all FAQ questions.
    Verify no raw `<` characters appear inside the JSON-LD scripts (XSS protection).
  </verify>
  <done>
    Homepage renders Organization JSON-LD and FAQPage JSON-LD. FAQ data is shared between the visual component and schema builder via exported FAQ_ITEMS array. XSS escaping active on all JSON-LD output.
  </done>
</task>

</tasks>

<verification>
1. `npm run build` succeeds with no errors
2. Homepage HTML source contains `<script type="application/ld+json">` with Organization schema
3. Homepage HTML source contains `<script type="application/ld+json">` with FAQPage schema
4. JSON-LD contains `\u003c` instead of `<` where applicable (XSS protection)
5. All schema builder functions exist and have correct TypeScript types
</verification>

<success_criteria>
- schema-dts dependency installed
- 6 new files in src/lib/schema/ (jsonld.tsx + 5 builders)
- Homepage outputs Organization and FAQPage JSON-LD
- All JSON-LD has XSS escaping
- Build passes with no TypeScript errors
</success_criteria>

<output>
After completion, create `.planning/phases/17-structured-data/17-01-SUMMARY.md`
</output>
