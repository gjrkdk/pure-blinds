---
phase: 17-structured-data
plan: 02
type: execute
wave: 2
depends_on: ["17-01"]
files_modified:
  - src/app/products/[...slug]/page.tsx
  - src/app/blog/[slug]/page.tsx
autonomous: true

must_haves:
  truths:
    - "Product detail pages contain Product JSON-LD with EUR starting price from pricing matrix"
    - "Product detail pages contain BreadcrumbList JSON-LD matching visible breadcrumb navigation"
    - "Blog post pages contain BlogPosting JSON-LD with title, date, and Pure Blinds as publisher"
    - "Blog post pages contain BreadcrumbList JSON-LD matching visible breadcrumb navigation"
    - "All JSON-LD on detail pages uses absolute URLs starting with https://"
  artifacts:
    - path: "src/app/products/[...slug]/page.tsx"
      provides: "Product and BreadcrumbList JSON-LD on product detail pages"
      contains: "buildProductSchema"
    - path: "src/app/blog/[slug]/page.tsx"
      provides: "BlogPosting and BreadcrumbList JSON-LD on blog detail pages"
      contains: "buildBlogPostSchema"
  key_links:
    - from: "src/app/products/[...slug]/page.tsx"
      to: "src/lib/schema/product.ts"
      via: "buildProductSchema import and call"
      pattern: "buildProductSchema"
    - from: "src/app/products/[...slug]/page.tsx"
      to: "src/lib/schema/breadcrumb.ts"
      via: "buildBreadcrumbSchema import and call"
      pattern: "buildBreadcrumbSchema"
    - from: "src/app/products/[...slug]/page.tsx"
      to: "src/lib/pricing/loader.ts"
      via: "loadPricingMatrix for minimum price calculation"
      pattern: "loadPricingMatrix"
    - from: "src/app/blog/[slug]/page.tsx"
      to: "src/lib/schema/blog.ts"
      via: "buildBlogPostSchema import and call"
      pattern: "buildBlogPostSchema"
    - from: "src/app/blog/[slug]/page.tsx"
      to: "src/lib/schema/breadcrumb.ts"
      via: "buildBreadcrumbSchema import and call"
      pattern: "buildBreadcrumbSchema"
---

<objective>
Wire Product, BlogPosting, and BreadcrumbList schemas into detail pages.

Purpose: Enable rich results eligibility for product pages (price display in Google Search) and blog posts (article rich results), plus breadcrumb display in search results on all detail pages.
Output: Product detail pages render Product + BreadcrumbList JSON-LD, blog post pages render BlogPosting + BreadcrumbList JSON-LD.
</objective>

<execution_context>
@/Users/robinkonijnendijk/.claude/get-shit-done/workflows/execute-plan.md
@/Users/robinkonijnendijk/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/17-structured-data/17-RESEARCH.md
@.planning/phases/17-structured-data/17-01-SUMMARY.md
@src/app/products/[...slug]/page.tsx
@src/app/blog/[slug]/page.tsx
@src/lib/pricing/loader.ts
@src/lib/product/catalog.ts
@src/lib/product/types.ts
@src/lib/pricing/types.ts
@src/components/layout/breadcrumbs.tsx
</context>

<tasks>

<task type="auto">
  <name>Task 1: Wire Product and BreadcrumbList schemas into product detail pages</name>
  <files>
    src/app/products/[...slug]/page.tsx
  </files>
  <action>
    Update `src/app/products/[...slug]/page.tsx` to add Product and BreadcrumbList JSON-LD:

    1. Add imports:
       - `import { JsonLd } from '@/lib/schema/jsonld'`
       - `import { buildProductSchema } from '@/lib/schema/product'`
       - `import { buildBreadcrumbSchema } from '@/lib/schema/breadcrumb'`
       - `import { loadPricingMatrix } from '@/lib/pricing/loader'`

    2. Define base URL at module level:
       ```ts
       const BASE_URL = process.env.NEXT_PUBLIC_SITE_URL || 'https://pureblinds.nl'
       ```

    3. In the `ProductPage` component function (which is already async):
       - After the `product` is resolved and the `notFound()` check passes, load the pricing matrix:
         ```ts
         const pricingMatrix = await loadPricingMatrix(product.pricingMatrixPath)
         ```
       - Build product schema:
         ```ts
         const productSchema = buildProductSchema(product, pricingMatrix, BASE_URL)
         ```
       - Build breadcrumb schema from the same `breadcrumbItems` array already constructed:
         ```ts
         const breadcrumbSchema = buildBreadcrumbSchema(breadcrumbItems, BASE_URL)
         ```
       - Add two `<JsonLd>` components at the top of the return JSX (inside the wrapper div, before the main content div):
         ```tsx
         <JsonLd data={productSchema} />
         <JsonLd data={breadcrumbSchema} />
         ```

    4. IMPORTANT pricing notes:
       - The pricing matrix stores prices in cents — the buildProductSchema function handles the cents-to-EUR conversion
       - Currency is hardcoded to EUR in the builder (NOT using matrix.currency which says "USD")
       - The minimum price across the entire matrix is used as the "vanaf" (starting from) price
  </action>
  <verify>
    Run `npm run build` — verify no build errors.
    Run `npm run dev` and navigate to a product page (e.g., /products/roller-blinds/transparent-roller-blinds/roller-blind-white).
    View page source and verify:
    - `<script type="application/ld+json">` with `"@type":"Product"` containing `"priceCurrency":"EUR"` and a numeric price
    - `<script type="application/ld+json">` with `"@type":"BreadcrumbList"` containing position 1 through N matching the visible breadcrumbs
    - All URLs in the schema are absolute (start with https://)
    - Brand name is "Pure Blinds"
    - availability is "https://schema.org/InStock"
  </verify>
  <done>
    Product detail pages render Product JSON-LD with EUR starting price from pricing matrix and BreadcrumbList JSON-LD matching the visible breadcrumb navigation. All URLs are absolute.
  </done>
</task>

<task type="auto">
  <name>Task 2: Wire BlogPosting and BreadcrumbList schemas into blog post pages</name>
  <files>
    src/app/blog/[slug]/page.tsx
  </files>
  <action>
    Update `src/app/blog/[slug]/page.tsx` to add BlogPosting and BreadcrumbList JSON-LD:

    1. Add imports:
       - `import { JsonLd } from '@/lib/schema/jsonld'`
       - `import { buildBlogPostSchema } from '@/lib/schema/blog'`
       - `import { buildBreadcrumbSchema } from '@/lib/schema/breadcrumb'`

    2. Define base URL at module level:
       ```ts
       const BASE_URL = process.env.NEXT_PUBLIC_SITE_URL || 'https://pureblinds.nl'
       ```

    3. In the `BlogPostPage` component function (already async):
       - After the `post` is resolved and the `notFound()` check passes, build schemas:
         ```ts
         const blogSchema = buildBlogPostSchema({
           title: post.title,
           excerpt: post.excerpt,
           date: post.date,
           slug: post.slug,
           readingTime: post.readingTime
         }, BASE_URL)
         ```
       - Build breadcrumb schema from the same breadcrumb items already defined inline:
         ```ts
         const breadcrumbItems = [
           { label: 'Home', href: '/' },
           { label: 'Blog', href: '/blog' },
           { label: post.title, current: true }
         ]
         const breadcrumbSchema = buildBreadcrumbSchema(breadcrumbItems, BASE_URL)
         ```
       - IMPORTANT: The breadcrumb items array is currently defined inline in the `<Breadcrumbs>` component prop. Extract it to a variable so it can be shared between the Breadcrumbs UI component and the schema builder. Pass the same variable to `<Breadcrumbs items={breadcrumbItems} />`.

    4. Add two `<JsonLd>` components at the top of the return JSX:
       ```tsx
       <JsonLd data={blogSchema} />
       <JsonLd data={breadcrumbSchema} />
       ```
       Place them inside the wrapper div, before the `<Breadcrumbs>` component.
  </action>
  <verify>
    Run `npm run build` — verify no build errors.
    Run `npm run dev` and navigate to a blog post page.
    View page source and verify:
    - `<script type="application/ld+json">` with `"@type":"BlogPosting"` containing headline, datePublished, author/publisher as Organization
    - `<script type="application/ld+json">` with `"@type":"BreadcrumbList"` with 3 items (Home, Blog, Post Title)
    - Publisher logo URL is absolute (starts with https://)
    - Blog post URL is absolute
  </verify>
  <done>
    Blog post pages render BlogPosting JSON-LD with Pure Blinds as publisher and BreadcrumbList JSON-LD matching visible breadcrumbs. All URLs are absolute.
  </done>
</task>

</tasks>

<verification>
1. `npm run build` succeeds with no errors
2. Product page source contains Product JSON-LD with EUR price and InStock availability
3. Product page source contains BreadcrumbList JSON-LD with correct hierarchy
4. Blog post page source contains BlogPosting JSON-LD with headline and publisher
5. Blog post page source contains BreadcrumbList JSON-LD with 3 items
6. All schema URLs are absolute (not relative)
7. All JSON-LD output has XSS escaping (\u003c instead of <)
</verification>

<success_criteria>
- Product detail pages output Product + BreadcrumbList JSON-LD
- Blog post pages output BlogPosting + BreadcrumbList JSON-LD
- EUR currency in Product schema (not USD from matrix file)
- Starting price (minimum matrix price) used in Product schema
- All URLs absolute
- Build passes with no TypeScript errors
</success_criteria>

<output>
After completion, create `.planning/phases/17-structured-data/17-02-SUMMARY.md`
</output>
