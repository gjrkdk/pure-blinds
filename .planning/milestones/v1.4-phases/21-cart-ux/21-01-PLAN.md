---
phase: 21-cart-ux
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - src/components/dimension-configurator.tsx
autonomous: true
requirements:
  - CART-01
  - CART-02

must_haves:
  truths:
    - "After adding a product, the single Toevoegen button is replaced by two stacked buttons: Naar winkelwagen (primary, top) and Nog een toevoegen (secondary, bottom)"
    - "Clicking Nog een toevoegen resets width, height, and price to empty/null defaults and restores the single Toevoegen button"
    - "Changing any dimension input (width or height) after adding resets back to the single Toevoegen button"
    - "After adding a sample, that sample button changes to Bekijk winkelwagen and clicking it navigates to /winkelwagen"
    - "On page load, if a sample is already in cart, the sample button shows Bekijk winkelwagen immediately"
    - "Product add-to-cart state and sample button state are completely independent"
  artifacts:
    - path: "src/components/dimension-configurator.tsx"
      provides: "Split button states for product add-to-cart and sample navigation"
      contains: "Naar winkelwagen"
  key_links:
    - from: "src/components/dimension-configurator.tsx"
      to: "/winkelwagen"
      via: "router.push on Naar winkelwagen and Bekijk winkelwagen buttons"
      pattern: "router\\.push.*winkelwagen"
---

<objective>
Implement split add-to-cart button states and sample button navigation on the product page.

Purpose: After adding a product or sample, give the customer clear next-step navigation instead of a momentary "Toegevoegd!" flash that disappears.

Output: Updated dimension-configurator.tsx with post-add button splitting and sample button state management.
</objective>

<execution_context>
@/Users/robinkonijnendijk/.claude/get-shit-done/workflows/execute-plan.md
@/Users/robinkonijnendijk/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/21-cart-ux/21-CONTEXT.md
@src/components/dimension-configurator.tsx
@src/lib/cart/store.ts
@src/lib/cart/types.ts
</context>

<tasks>

<task type="auto">
  <name>Task 1: Implement split add-to-cart button and sample button state changes</name>
  <files>src/components/dimension-configurator.tsx</files>
  <action>
Refactor the dimension-configurator.tsx component to implement post-add button splitting and sample button navigation. All changes are within this single file.

**Add router import:**
- Import `useRouter` from `next/navigation` at the top of the component.
- Create `const router = useRouter()` inside the component.

**Replace `addedFeedback` state with `addedToCart` boolean:**
- Remove `const [addedFeedback, setAddedFeedback] = useState(false)` and its 2-second timeout.
- Add `const [addedToCart, setAddedToCart] = useState(false)` — this persists until the customer takes an action (no auto-reset timer).

**Remove `sampleFeedback` state entirely:**
- The sample button no longer needs a temporary feedback state. It transitions based on `hasSample` from the cart store.

**Update `handleAddToCart`:**
- After calling `addItem(...)`, set `setAddedToCart(true)`.
- Do NOT use setTimeout — the split state persists until form reset or dimension change.

**Add `handleResetForm` function:**
- Resets `width` to `""`, `height` to `""`, `price` to `null`, `error` to `null`, `fieldErrors` to `{}`.
- Sets `addedToCart` back to `false`.
- This is called when the customer clicks "Nog een toevoegen".

**Reset `addedToCart` when dimensions change:**
- In `handleWidthChange` and `handleHeightChange`, add `setAddedToCart(false)` so that changing any dimension returns to the single "Toevoegen" button.

**Update `handleAddSample`:**
- Simplify to just call `addSample({ productId, productName })`.
- Remove the `sampleFeedback` guard and timeout. The `hasSample` check from the store already prevents duplicates.

**Update `canAddToCart`:**
- Remove the `!addedFeedback` condition. Replace with `!addedToCart` so the single button is disabled when already added (the split buttons take over).

**Render the add-to-cart button area:**
Replace the current button section with conditional rendering:

```tsx
{addedToCart ? (
  <div className="flex flex-col gap-2">
    <button
      onClick={() => router.push('/winkelwagen')}
      className="w-full bg-accent text-accent-foreground py-3 text-sm font-medium tracking-wide transition-opacity hover:opacity-80 rounded-lg"
    >
      Naar winkelwagen &rarr;
    </button>
    <button
      onClick={handleResetForm}
      className="w-full bg-neutral-100 text-foreground py-3 text-sm font-medium tracking-wide transition-opacity hover:opacity-80 rounded-lg"
    >
      Nog een toevoegen
    </button>
  </div>
) : (
  <button
    onClick={handleAddToCart}
    disabled={!canAddToCart}
    className="w-full bg-accent text-accent-foreground py-3 text-sm font-medium tracking-wide transition-opacity hover:opacity-80 disabled:opacity-40 disabled:cursor-not-allowed border-border rounded-lg"
  >
    Toevoegen
  </button>
)}
```

Note the button label changes from "Toevoegen aan winkelwagen" to just "Toevoegen" per the phase success criteria. The "Naar winkelwagen" button uses the primary accent style (bold/filled). The "Nog een toevoegen" button uses a muted `bg-neutral-100` style (lighter background, less visual weight). No animation on the transition — instant swap per locked decision.

**Render the sample button:**
Replace the current sample button with:

```tsx
{hasSample ? (
  <button
    onClick={() => router.push('/winkelwagen')}
    className="w-full bg-accent text-accent-foreground py-3 text-sm font-medium tracking-wide transition-opacity hover:opacity-80 rounded-lg"
  >
    Bekijk winkelwagen &rarr;
  </button>
) : (
  <button
    onClick={handleAddSample}
    className="w-full border border-border bg-white text-foreground py-3 text-sm font-medium tracking-wide transition-opacity hover:opacity-80 rounded-lg"
  >
    Kleurstaal bestellen
  </button>
)}
```

The "Bekijk winkelwagen" button uses the same primary accent style as "Naar winkelwagen" per locked decision. On page load, `hasSample` is read from the Zustand store (which loads from localStorage), so if a sample was already added, the button immediately shows "Bekijk winkelwagen" — no additional logic needed.

**Key behaviors to preserve:**
- The `hasSample` selector from the cart store already handles the "already in cart" check.
- Product and sample button states are independent — `addedToCart` only affects the product button, `hasSample` only affects the sample button.
- The disabled state on the sample button when `hasSample` is true can be removed since the button now navigates instead.
  </action>
  <verify>
Run `npx next build` to confirm no TypeScript errors. Verify the component renders both button states by visual inspection in the browser:
1. Load a product page — see single "Toevoegen" button and "Kleurstaal bestellen" button.
2. Enter dimensions and add to cart — button splits into "Naar winkelwagen" (top) and "Nog een toevoegen" (bottom).
3. Click "Nog een toevoegen" — form resets, single "Toevoegen" button returns.
4. Change a dimension after adding — single "Toevoegen" button returns.
5. Click "Kleurstaal bestellen" — button changes to "Bekijk winkelwagen".
6. Reload page — sample button still shows "Bekijk winkelwagen" (persisted state).
  </verify>
  <done>
Product add-to-cart button splits into "Naar winkelwagen" (primary, top) and "Nog een toevoegen" (secondary, bottom) after adding. Changing dimensions or clicking "Nog een toevoegen" resets to single "Toevoegen" button. Sample button changes to "Bekijk winkelwagen" after adding, and both buttons navigate to /winkelwagen when clicked. States are independent and sample state persists across page loads.
  </done>
</task>

</tasks>

<verification>
- `npx next build` completes without errors
- Product page shows correct button states before and after adding items
- Sample button reflects cart state on page load
- No regressions in dimension input, price calculation, or cart functionality
</verification>

<success_criteria>
- Single "Toevoegen" button visible before adding product to cart
- After adding product: two stacked buttons appear — "Naar winkelwagen" (primary) on top, "Nog een toevoegen" (muted) below
- "Nog een toevoegen" resets form fields to empty and returns to single button
- Changing width or height after adding returns to single button
- "Kleurstaal bestellen" becomes "Bekijk winkelwagen" after adding sample
- Both navigation buttons route to /winkelwagen
- Page reload preserves sample button state
</success_criteria>

<output>
After completion, create `.planning/phases/21-cart-ux/21-01-SUMMARY.md`
</output>
