---
phase: 21-cart-ux
plan: 02
type: execute
wave: 1
depends_on: []
files_modified:
  - src/components/layout/header.tsx
autonomous: true
requirements:
  - CART-03

must_haves:
  truths:
    - "On mobile (below md breakpoint), a cart icon is visible in the header to the left of the hamburger menu"
    - "On desktop (md and above), the cart icon is NOT shown next to the hamburger — the existing text Winkelwagen link in desktop nav remains unchanged"
    - "When cart is empty, the icon is visible but no badge is shown"
    - "When cart has items, a badge with the item count appears on the icon"
    - "The badge count updates immediately when items are added or removed"
    - "Badge shows a subtle pulse animation when the count changes"
  artifacts:
    - path: "src/components/layout/header.tsx"
      provides: "Mobile cart icon with badge next to hamburger menu"
      contains: "md:hidden"
  key_links:
    - from: "src/components/layout/header.tsx"
      to: "@/lib/cart/store"
      via: "useCartStore getItemCount selector"
      pattern: "useCartStore.*getItemCount"
---

<objective>
Add a mobile-only cart icon with item count badge to the header, positioned to the left of the hamburger menu.

Purpose: On mobile, the cart is only accessible through the hamburger menu dropdown. A persistent cart icon with badge gives customers constant visibility of their cart state and quick access without opening the menu.

Output: Updated header.tsx with mobile cart icon and animated badge.
</objective>

<execution_context>
@/Users/robinkonijnendijk/.claude/get-shit-done/workflows/execute-plan.md
@/Users/robinkonijnendijk/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/21-cart-ux/21-CONTEXT.md
@src/components/layout/header.tsx
@src/components/cart/cart-icon.tsx
@src/lib/cart/store.ts
</context>

<tasks>

<task type="auto">
  <name>Task 1: Add mobile cart icon with animated badge to header</name>
  <files>src/components/layout/header.tsx</files>
  <action>
Add a mobile-only cart icon with item count badge to the header, positioned to the left of the hamburger menu button. All changes are within header.tsx.

**Add imports:**
- Import `useCartStore` from `@/lib/cart/store`.
- Import `useSyncExternalStore, useRef` from `react` (add to existing import).
- Import `Link` is already imported.

**Add cart state and animation tracking inside the Header component:**

```tsx
// Cart state for mobile badge
const emptySubscribe = () => () => {};
const mounted = useSyncExternalStore(emptySubscribe, () => true, () => false);
const itemCount = useCartStore((state) => state.getItemCount());

// Track previous count to detect changes for pulse animation
const prevCountRef = useRef(itemCount);
const [badgePulse, setBadgePulse] = useState(false);

useEffect(() => {
  if (mounted && itemCount !== prevCountRef.current && itemCount > 0) {
    setBadgePulse(true);
    const timer = setTimeout(() => setBadgePulse(false), 300);
    prevCountRef.current = itemCount;
    return () => clearTimeout(timer);
  }
  prevCountRef.current = itemCount;
}, [itemCount, mounted]);
```

This uses the same `useSyncExternalStore` hydration pattern as the existing `CartIcon` component to avoid SSR/client mismatch. The `prevCountRef` tracks the previous count to trigger a pulse animation only when the count actually changes.

**Add mobile cart icon in the header bar, to the LEFT of the hamburger button:**

Find the hamburger button (the `<button className="md:hidden ...">` element). Wrap both the new cart link and the hamburger button in a flex container, or insert the cart icon just before the hamburger button:

```tsx
{/* Mobile cart icon + hamburger */}
<div className="md:hidden flex items-center gap-2">
  <Link
    href="/winkelwagen"
    className="relative inline-flex items-center justify-center w-8 h-8"
    aria-label="Winkelwagen"
  >
    <svg
      xmlns="http://www.w3.org/2000/svg"
      fill="none"
      viewBox="0 0 24 24"
      strokeWidth={1.5}
      stroke="currentColor"
      className="h-5 w-5 text-foreground"
    >
      <path
        strokeLinecap="round"
        strokeLinejoin="round"
        d="M15.75 10.5V6a3.75 3.75 0 10-7.5 0v4.5m11.356-1.993l1.263 12c.07.665-.45 1.243-1.119 1.243H4.25a1.125 1.125 0 01-1.12-1.243l1.264-12A1.125 1.125 0 015.513 7.5h12.974c.576 0 1.059.435 1.119 1.007zM8.625 10.5a.375.375 0 11-.75 0 .375.375 0 01.75 0zm7.5 0a.375.375 0 11-.75 0 .375.375 0 01.75 0z"
      />
    </svg>
    {mounted && itemCount > 0 && (
      <span
        className={`absolute -top-0.5 -right-0.5 flex h-4 min-w-4 items-center justify-center rounded-full bg-foreground px-1 text-[10px] font-semibold text-accent-foreground transition-transform ${
          badgePulse ? "scale-125" : "scale-100"
        }`}
      >
        {itemCount}
      </span>
    )}
  </Link>
  <button
    className="flex flex-col items-center justify-center w-8 h-8 gap-1.5 focus:outline-none"
    onClick={() => setMenuOpen(!menuOpen)}
    aria-label="Menu openen"
  >
    <span
      className={`w-5 h-0.5 bg-foreground transition-all duration-300 ${
        menuOpen ? "rotate-45 translate-y-1" : ""
      }`}
    />
    <span
      className={`w-5 h-0.5 bg-foreground transition-all duration-300 ${
        menuOpen ? "-rotate-45 -translate-y-1" : ""
      }`}
    />
  </button>
</div>
```

The icon uses a shopping bag SVG (Heroicons `shopping-bag` outline) — a clean, minimal icon that fits the store aesthetic. The badge uses the same styling as the existing desktop CartIcon component (`bg-foreground`, `text-accent-foreground`, `text-[10px]`, `font-semibold`) to match nav styling per locked decision. The `transition-transform` with scale creates a subtle pulse/bounce effect when items change.

**Remove the standalone hamburger button:**
The old hamburger `<button className="md:hidden ...">` is now inside the new wrapper div. Remove the original standalone one to avoid duplicate.

**Keep the existing desktop CartIcon untouched:**
The `<div className="hidden md:flex items-center gap-2">` block with `<CartIcon />` remains as-is. Desktop continues to show the icon-based cart link in the nav.

**Keep the mobile menu CartIcon as-is:**
The mobile dropdown menu at the bottom still shows `<CartIcon />` in the border-t section. This is fine — it provides a second access point within the expanded menu.

**Color matching:**
The icon uses `text-foreground` to match existing navigation text color. The badge uses `bg-foreground` and `text-accent-foreground` to match the desktop CartIcon badge styling. No separate accent color — per locked decision.
  </action>
  <verify>
Run `npx next build` to confirm no TypeScript errors. Verify in the browser:
1. Resize to mobile width (below 768px) — cart icon visible to left of hamburger menu.
2. Resize to desktop width (768px+) — mobile cart icon hidden, desktop CartIcon visible in nav.
3. Cart empty — icon visible, no badge.
4. Add item to cart — badge appears with count "1", shows brief scale pulse.
5. Add another item — badge updates to "2" with pulse.
6. Remove items — badge disappears when count reaches 0.
7. Click mobile cart icon — navigates to /winkelwagen.
  </verify>
  <done>
Mobile header shows a cart icon (shopping bag) with item count badge to the left of the hamburger menu. Badge only appears when count > 0. Badge pulses briefly when count changes. Icon matches nav text color, badge matches nav styling. Desktop navigation is unchanged.
  </done>
</task>

</tasks>

<verification>
- `npx next build` completes without errors
- Mobile header shows cart icon + badge to left of hamburger
- Desktop header unchanged (existing CartIcon in nav)
- Badge count reflects actual cart state in real-time
- Pulse animation triggers on count change
</verification>

<success_criteria>
- Cart icon visible on mobile (below md breakpoint) next to hamburger menu
- Cart icon hidden on desktop (md and above)
- No badge when cart is empty, badge with count when items present
- Badge count updates immediately on add/remove
- Subtle pulse animation on badge when count changes
- Clicking icon navigates to /winkelwagen
</success_criteria>

<output>
After completion, create `.planning/phases/21-cart-ux/21-02-SUMMARY.md`
</output>
